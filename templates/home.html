{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<h2 style="text-align: center; background-color: green; color: white; border: 5px solid green;">All Issues</h2>

<div style="text-align:center; margin-bottom:20px;">
    <a href="{{ url_for('create_issue') }}"
       style="
            display:inline-block;
            background:#007bff;
            color:white;
            padding:10px 16px;
            text-decoration:none;
            border-radius:5px;
       ">
       + Create New Issue
    </a>
</div>

<!-- Center container -->
<div style="max-width:700px; margin:auto;">

    {% for issue in issues %}
        <div style="
            background:white;
            padding:15px;
            border-radius:6px;
            box-shadow:0 2px 4px rgba(0,0,0,0.1);
            margin-bottom:20px;
        ">
            <strong style="font-size:18px;">{{ issue.title }}</strong>
            <span style="
                background:#eee;
                padding:3px 6px;
                border-radius:3px;
                font-size:12px;
                margin-left:5px;
            ">
                [{{ issue.priority }}]
            </span>

            <p style="margin-top:10px;">
                <strong>Description:</strong> {{ issue.description }}
            </p>

            <p><strong>Resolution:</strong> {{ issue.resolution }}</p>

            <p>
                <strong>Status:</strong>
                {% if issue.status == "Resolved" %}
                    <span style="color:green; font-weight:bold;">Resolved</span>
                {% else %}
                    <span style="color:red; font-weight:bold;">Pending</span>
                {% endif %}
            </p>

            <p style="font-size:13px; color:#555;">
                Posted by: {{ issue.user.email }}
            </p>

            <!-- Edit -->
            <a href="{{ url_for('edit_issue', issue_id=issue.id) }}"
               style="color:#007bff; text-decoration:none; font-weight:bold;">
                Edit
            </a>

            <!-- Approval Requests -->
            {% if issue.posted_by == current_user.id %}
                {% for req in issue.approval_requests %}
                    {% if req.status == "Pending" %}
                        <p style="color:blue; margin-top:10px;">
                            Request from {{ req.requester.email }} to edit this issue â€”
                            <a href="{{ url_for('approve_request', request_id=req.id) }}">Approve</a> |
                            <a href="{{ url_for('reject_request', request_id=req.id) }}">Reject</a>
                        </p>
                    {% endif %}
                {% endfor %}
            {% endif %}
        </div>

    {% else %}
        <p style="text-align:center; margin-top:30px;">No issues yet. Add one!</p>
    {% endfor %}
</div>

{% endblock %}
